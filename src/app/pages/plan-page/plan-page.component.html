<section *ngIf="publication">
    <header>
        <div [routerLink]="['/author', publication.author]">
            <div class="image-wrapper">
                <img [src]="publication.authorAv || '../../../../assets/avatar.jpg'" alt="Author's avatar">
            </div>
            <span>{{publication.author}}</span>
        </div>
        <div class="dates">
            <small>Created: {{publication.created | date:'MMMM d, y - H:mm:ss'}}</small>
            <small *ngIf="publication.modified">Modified: {{publication.modified | date:'MMMM d, y - H:mm:ss'}}</small>
        </div>
    </header>
    <hr>
    <body>
        <article>
            <h1>{{publication.title}}</h1>
            <quill-view-html [content]="publication.text"></quill-view-html>
            <div class="categories">
                <p *ngIf="publication.filters.continent">
                    {{publication.filters.continent}}
                </p>
                <p *ngIf="publication.filters.country">
                    {{publication.filters.country}}
                </p>
                <p *ngIf="publication.filters.city" id='city'>
                    {{publication.filters.city}}
                </p>
                <p *ngIf="publication.filters.duration">
                    {{publication.filters.duration}}
                    {{publication.filters.duration === '1' ? ' day' : ' days'}}
                </p>
                <p *ngIf="publication.filters.people">
                    {{publication.filters.people}}
                    {{publication.filters.people === '1' ? ' person' : ' people'}}
                </p>
                <p *ngIf="publication.filters.budget">
                    {{publication.filters.budget.split('').includes('+')
                        ? 'Over ' + publication.filters.budget
                        : 'Up to ' + publication.filters.budget
                    }}$ per person
                </p>
            </div>
        </article>
        <div id="comments">
            <button
                *ngIf="showGetCommentsBtn; else commentsBlock"
                type="button"
                [disabled]="submitted"
                (click)="fetchComments()"
            >Load comments {{publication.comments || null}}</button>
            <ng-template #commentsBlock>
                <div *ngIf="auth.isAuthenticated(); else notAuthed" class="comment-form">
                    <textarea [(ngModel)]="commentText" (input)="autoResize($event)"></textarea>
                    <emoji-mart
                        color="#880000"
                        emoji=""
                        [emojiSize]="16"
                        [enableSearch]="false"
                        [isNative]="true"
                        [perLine]="8"
                        [showPreview]="false"
                        (emojiSelect)="addEmoji($event)"
                    ></emoji-mart>
                    <div class="buttons">
                        <button
                            type="button"
                            [disabled]="!commentText || submitted"
                            (click)="cancelCommenting()"
                        >Cancel</button>
                        <button
                            type="submit"
                            [disabled]="!commentText || submitted"
                            (click)="saveComment()"
                        >Submit</button>
                    </div>
                </div>
                <ng-template #notAuthed>
                    <div class="not-authorized">
                        <p>Only authorized users can comment</p>
                    </div>
                </ng-template>
                <div *ngIf="comments.length; else noComments" class="comments">
                    <app-comment
                        *ngFor="let comment of comments"
                        [comment]="comment"
                        (onAddAnswer)="saveAnswer($event)"
                    ></app-comment>
                </div>
                <ng-template #noComments>
                    <p>There are no comments yet</p>
                </ng-template>
            </ng-template>
        </div>
    </body>
</section>
